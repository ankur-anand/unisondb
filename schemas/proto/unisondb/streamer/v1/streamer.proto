syntax = "proto3";
package unisondb.streamer.v1;

option go_package = "github.com/ankur-anand/unisondb/schemas/proto/gen/go/unisondb/streamer/v1";

import "google/protobuf/timestamp.proto";

// WalStreamerService streams Wal Records.
service WalStreamerService {
  rpc StreamWalRecords(StreamWalRecordsRequest) returns (stream StreamWalRecordsResponse);
  rpc GetLatestLSN(GetLatestLSNRequest) returns (GetLatestLSNResponse);
}

message StreamWalRecordsRequest {
  optional uint64 start_lsn = 1;
}

message GetLatestLSNRequest {}

message GetLatestLSNResponse {
  uint64 lsn = 1;
}

message StreamWalRecordsResponse {
  // A batch of WAL records
  repeated WALRecord records = 1;
  google.protobuf.Timestamp server_timestamp = 2;
}

// WAL Record Format
message WALRecord {
  bytes record = 1;
  fixed32 crc32_checksum = 2;
}
